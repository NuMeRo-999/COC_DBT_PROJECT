version: 2

models:
  - name: clan
    config:
      contract:
        enforced: true
    description: >
      Staging table for clan data extracted from raw JSON.
    columns:
      - name: clan_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the clan.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: >
          Name of the clan.
      - name: type
        data_type: varchar
        description: >
          Type of clan (open, closed, etc.).
      - name: description
        data_type: text
        description: >
          Clan description.
      - name: clan_level
        data_type: int
        description: >
          Current level of the clan.
      - name: clan_points
        data_type: int
        description: >
          Total clan points.
      - name: war_wins
        data_type: int
        description: >
          Total war wins.
      - name: war_losses
        data_type: int
        description: >
          Total war losses.
      - name: members
        data_type: int
        description: >
          Number of clan members.
      - name: ingest_ts
        data_type: timestamp
        constraints:
          - type: not_null
        description: >
          Timestamp when data was ingested.

  - name: player
    config:
      contract:
        enforced: true
    description: >
      Staging table for player data extracted from raw JSON.
    columns:
      - name: player_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the player.
        data_tests:
          - not_null
      - name: clan_id
        data_type: varchar
        description: >
          Clan identifier the player belongs to.
      - name: name
        data_type: varchar
        description: >
          Player name.
      - name: town_hall_level
        data_type: int
        description: >
          Town hall level of the player.
      - name: exp_level
        data_type: int
        description: >
          Experience level of the player.
      - name: trophies
        data_type: int
        description: >
          Current trophies.
      - name: war_stars
        data_type: int
        description: >
          Total war stars earned.
      - name: role
        data_type: varchar
        description: >
          Role in clan (member, elder, coLeader, leader).
      - name: war_preference
        data_type: varchar
        description: >
          War preference (in/out).
      - name: donations
        data_type: int
        description: >
          Troops donated.
      - name: donations_received
        data_type: int
        description: >
          Troops received.
      - name: ingest_ts
        data_type: timestamp
        constraints:
          - type: not_null
        description: >
          Timestamp when data was ingested.

  - name: clan_war
    config:
      contract:
        enforced: true
    description: >
      Combined war data from current war and war log.
    columns:
      - name: clan_war_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the clan war.
        data_tests:
          - not_null
          - unique
      - name: state
        data_type: varchar
        description: >
          War state (win/lose/draw/inWar/preparation).
      - name: clan_id
        data_type: varchar
        description: >
          Clan identifier.
      - name: opponent_clan_tag
        data_type: varchar
        description: >
          Opponent clan tag.
      - name: team_size
        data_type: int
        description: >
          Number of players in war.
      - name: attacks
        data_type: int
        description: >
          Total attacks made.
      - name: stars
        data_type: int
        description: >
          Total stars earned.
      - name: start_time
        data_type: datetime
        description: >
          War start time.
      - name: end_time
        data_type: datetime
        description: >
          War end time.
      - name: destruction_percentage
        data_type: float
        description: >
          Total destruction percentage.
      - name: ingest_ts
        data_type: timestamp
        constraints:
          - type: not_null
        description: >
          Timestamp when data was ingested.

  - name: war_state
    config:
      contract:
        enforced: true
    description: >
      Reference table for war states.
    columns:
      - name: war_state_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for war state.
        data_tests:
          - not_null
          - unique
      - name: war_state
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          War state description.

  - name: player_attack
    config:
      contract:
        enforced: true
    description: >
      Player attacks in wars.
    columns:
      - name: attack_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the attack.
        data_tests:
          - not_null
          - unique
      - name: attacker_id
        data_type: varchar
        description: >
          Player who made the attack.
      - name: defender_tag
        data_type: varchar
        description: >
          Player who was attacked.
      - name: stars
        data_type: int
        description: >
          Stars earned in attack.
      - name: destruction_percentage
        data_type: float
        description: >
          Destruction percentage.
      - name: map_position
        data_type: int
        description: >
          Map position of attacker.
      - name: duration
        data_type: int
        description: >
          Attack duration in seconds.
      - name: ingest_ts
        data_type: timestamp
        constraints:
          - type: not_null
        description: >
          Timestamp when data was ingested.

  - name: heroes
    config:
      contract:
        enforced: true
    description: >
      Reference table for all heroes.
    columns:
      - name: hero_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the hero.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Hero name.
      - name: village
        data_type: varchar
        description: >
          Village type (home/builderBase).

  - name: troops
    config:
      contract:
        enforced: true
    description: >
      Reference table for all troops.
    columns:
      - name: troop_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the troop.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Troop name.
      - name: village
        data_type: varchar
        description: >
          Village type (home/builderBase).

  - name: spells
    config:
      contract:
        enforced: true
    description: >
      Reference table for all spells.
    columns:
      - name: spell_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the spell.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Spell name.
      - name: village
        data_type: varchar
        description: >
          Village type (home/builderBase).

  - name: achievements
    config:
      contract:
        enforced: true
    description: >
      Reference table for all achievements.
    columns:
      - name: achievement_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the achievement.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Achievement name.
      - name: target
        data_type: int
        description: >
          Target value for achievement.
      - name: info
        data_type: text
        description: >
          Achievement description.
      - name: village
        data_type: varchar
        description: >
          Village type.

  - name: hero_equipment
    config:
      contract:
        enforced: true
    description: >
      Reference table for hero equipment.
    columns:
      - name: hero_equipment_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for the hero equipment.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Equipment name.
      - name: village
        data_type: varchar
        description: >
          Village type.

  - name: player_troop
    config:
      contract:
        enforced: true
    description: >
      Relationship between players and their troops with levels.
    columns:
      - name: player_troop_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for player-troop relationship.
        data_tests:
          - not_null
          - unique
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
      - name: troop_id
        data_type: varchar
        description: >
          Troop identifier.
      - name: level
        data_type: int
        description: >
          Current troop level.
      - name: max_level
        data_type: int
        description: >
          Maximum troop level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: player_hero
    config:
      contract:
        enforced: true
    description: >
      Relationship between players and their heroes with levels.
    columns:
      - name: player_hero_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for player-hero relationship.
        data_tests:
          - not_null
          - unique
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
      - name: hero_id
        data_type: varchar
        description: >
          Hero identifier.
      - name: level
        data_type: int
        description: >
          Current hero level.
      - name: max_level
        data_type: int
        description: >
          Maximum hero level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: player_spell
    config:
      contract:
        enforced: true
    description: >
      Relationship between players and their spells with levels.
    columns:
      - name: player_spell_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for player-spell relationship.
        data_tests:
          - not_null
          - unique
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
      - name: spell_id
        data_type: varchar
        description: >
          Spell identifier.
      - name: level
        data_type: int
        description: >
          Current spell level.
      - name: max_level
        data_type: int
        description: >
          Maximum spell level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: player_achievement
    config:
      contract:
        enforced: true
    description: >
      Relationship between players and their achievements with progress.
    columns:
      - name: player_achievement_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for player-achievement relationship.
        data_tests:
          - not_null
          - unique
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
      - name: achievement_id
        data_type: varchar
        description: >
          Achievement identifier.
      - name: value
        data_type: int
        description: >
          Current achievement progress.
      - name: stars
        data_type: int
        description: >
          Stars earned for achievement.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: player_hero_equipment
    config:
      contract:
        enforced: true
    description: >
      Relationship between player heroes and their equipment with levels.
    columns:
      - name: player_hero_equipment_id
        data_type: varchar
        constraints:
          - type: not_null
        description: >
          Unique identifier for player-hero-equipment relationship.
        data_tests:
          - not_null
          - unique
      - name: player_hero_id
        data_type: varchar
        description: >
          Player-hero relationship identifier.
      - name: hero_equipment_id
        data_type: varchar
        description: >
          Hero equipment identifier.
      - name: level
        data_type: int
        description: >
          Current equipment level.
      - name: max_level
        data_type: int
        description: >
          Maximum equipment level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.