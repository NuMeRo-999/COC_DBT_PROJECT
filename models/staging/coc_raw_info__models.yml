version: 2

models:
  - name: stg_coc_info__player
    description: >
      Staging table for player data extracted from raw JSON.
    columns:
      - name: player_id
        data_type: varchar
        description: >
          Unique identifier for the player.
        data_tests:
          - not_null
      - name: clan_id
        data_type: varchar
        description: >
          Clan identifier the player belongs to.
      - name: name
        data_type: varchar
        description: >
          Player name.
      - name: town_hall_level
        data_type: int
        description: >
          Town hall level of the player.
        data_tests:
          - not_null
      - name: exp_level
        data_type: int
        description: >
          Experience level of the player.
        data_tests:
          - not_null
      - name: trophies
        data_type: int
        description: >
          Current trophies.
      - name: best_trophies
        data_type: int
        description: >
          Best trophies achieved.
      - name: war_stars
        data_type: int
        description: >
          Total war stars earned.
      - name: attack_wins
        data_type: int
        description: >
          Attack wins.
      - name: defense_wins
        data_type: int
        description: >
          Defense wins.
      - name: role
        data_type: varchar
        description: >
          Role in clan (member, elder, coLeader, leader).
      - name: war_preference
        data_type: varchar
        description: >
          War preference (in/out).
      - name: donations
        data_type: int
        description: >
          Troops donated.
      - name: donations_received
        data_type: int
        description: >
          Troops received.
      - name: clan_capital_contributions
        data_type: bigint
        description: >
          Clan capital contributions.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.
        data_tests:
          - not_null

  - name: stg_coc_info__player_attack
    description: >
      Player attacks in wars.
    columns:
      - name: attack_id
        data_type: varchar
        description: >
          Unique identifier for the attack.
        data_tests:
          - not_null
          - unique
      - name: clan_war_id
        data_type: varchar
        description: >
          Clan war identifier.
        data_tests:
          - not_null
      - name: attacker_id
        data_type: varchar
        description: >
          Player who made the attack.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__player')
                field: player_id
      - name: defender_tag
        data_type: varchar
        description: >
          Player who was attacked.
      - name: stars
        data_type: int
        description: >
          Stars earned in attack.
      - name: destruction_percentage
        data_type: float
        description: >
          Destruction percentage.
      - name: attack_number
        data_type: int
        description: >
          Attack number.
      - name: map_position
        data_type: int
        description: >
          Map position of attacker.
      - name: duration
        data_type: int
        description: >
          Attack duration in seconds.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.
        data_tests:
          - not_null

  - name: stg_coc_info__clan
    description: >
      Staging table for clan data extracted from raw JSON.
    columns:
    - name: clan_id
      data_type: varchar
      description: >
        Unique identifier for the clan.
      data_tests:
        - not_null
    - name: clan_tag
      data_type: varchar
      description: >
        Clan tag.
    - name: name
      data_type: varchar
      description: >
        Clan name.
    - name: type
      data_type: varchar
      description: >
        Clan type (open, closed, etc.).
    - name: description
      data_type: varchar
      description: >
        Clan description.
    - name: location
      data_type: varchar
      description: >
        Clan location.
    - name: is_family_friendly
      data_type: boolean
      description: >
        Whether the clan is family friendly.
    - name: badge_url
      data_type: varchar
      description: >
        Clan badge URL.
    - name: clan_level
      data_type: int
      description: >
        Clan level.
    - name: clan_points
      data_type: int
      description: >
        Clan points.
    - name: required_trophies
      data_type: int
      description: >
        Required trophies to join.
    - name: war_frequency
      data_type: varchar
      description: >
        War frequency.
    - name: war_win_streak
      data_type: int
      description: >
        Current war win streak.
    - name: war_wins
      data_type: int
      description: >
        Total war wins.
    - name: war_ties
      data_type: int
      description: >
        Total war ties.
    - name: war_losses
      data_type: int
      description: >
        Total war losses.
    - name: is_war_log_public
      data_type: boolean
      description: >
        Whether war log is public.
    - name: war_league
      data_type: varchar
      description: >
        War league.
    - name: members
      data_type: int
      description: >
        Number of members.
    - name: required_builder_base_trophies
      data_type: int
      description: >
        Required builder base trophies.
    - name: required_townhall_level
      data_type: int
      description: >
        Required townhall level.
    - name: chat_language
      data_type: varchar
      description: >
        Chat language.
    - name: ingest_ts
      data_type: timestamp
      description: >
        Timestamp when data was ingested.
      data_tests:
        - not_null

  - name: stg_coc_info__clan_war
    description: >
      Combined war data from current war and war log.
    columns:
      - name: clan_war_id
        data_type: varchar
        description: >
          Unique identifier for the clan war.
        data_tests:
          - not_null
          - unique
      - name: state_id
        data_type: varchar
        description: >
          War state (win/lose/draw/inWar/preparation).
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__war_state')
                field: state_id
      - name: clan_id
        data_type: varchar
        description: >
          Clan identifier.
      - name: opponent_clan_tag
        data_type: varchar
        description: >
          Opponent clan tag.
      - name: opponent_clan_name
        data_type: varchar
        description: >
          Opponent clan name.
      - name: team_size
        data_type: int
        description: >
          Number of players in war.
      - name: attacks_per_member
        data_type: int
        description: >
          Attacks per member.
      - name: battle_modifier
        data_type: varchar
        description: >
          Battle modifier.
      - name: badge_urls
        data_type: variant
        description: >
          Badge URLs.
      - name: clan_level
        data_type: int
        description: >
          Clan level.
      - name: attacks
        data_type: int
        description: >
          Total attacks made.
      - name: stars
        data_type: int
        description: >
          Total stars earned.
      - name: start_time
        data_type: datetime
        description: >
          War start time.
      - name: end_time
        data_type: datetime
        description: >
          War end time.
      - name: destruction_percentage
        data_type: float
        description: >
          Total destruction percentage.
      - name: exp_earned
        data_type: int
        description: >
          Experience earned.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.
        data_tests:
          - not_null

  - name: stg_coc_info__war_state
    description: >
      Reference table for war states.
    columns:
      - name: state_id
        data_type: varchar
        description: >
          Unique identifier for war state.
        data_tests:
          - not_null
          - unique
      - name: state
        data_type: varchar
        description: >
          War state description.
        data_tests:
          - not_null

  - name: stg_coc_info__heroes
    description: >
      Reference table for all heroes.
    columns:
      - name: hero_id
        data_type: varchar
        description: >
          Unique identifier for the hero.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: >
          Hero name.
        data_tests:
          - not_null
      - name: village
        data_type: varchar
        description: >
          Village type (home/builderBase).

  - name: stg_coc_info__troops
    description: >
      Reference table for all troops.
    columns:
      - name: troop_id
        data_type: varchar
        description: >
          Unique identifier for the troop.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: >
          Troop name.
        data_tests:
          - not_null
      - name: village
        data_type: varchar
        description: >
          Village type (home/builderBase).

  - name: stg_coc_info__spells
    description: >
      Reference table for all spells.
    columns:
      - name: spell_id
        data_type: varchar
        description: >
          Unique identifier for the spell.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: >
          Spell name.
        data_tests:
          - not_null
      - name: village
        data_type: varchar
        description: >
          Village type (home/builderBase).

  - name: stg_coc_info__achievements
    description: >
      Reference table for all achievements.
    columns:
      - name: achievement_id
        data_type: varchar
        description: >
          Unique identifier for the achievement.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: >
          Achievement name.
        data_tests:
          - not_null
      - name: target
        data_type: int
        description: >
          Target value for achievement.
      - name: info
        data_type: text
        description: >
          Achievement description.
      - name: completion_info
        data_type: text
        description: >
          Completion information.
      - name: village
        data_type: varchar
        description: >
          Village type.

  - name: stg_coc_info__hero_equipment
    description: >
      Reference table for hero equipment.
    columns:
      - name: hero_equipment_id
        data_type: varchar
        description: >
          Unique identifier for the hero equipment.
        data_tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: >
          Equipment name.
        data_tests:
          - not_null
      - name: village
        data_type: varchar
        description: >
          Village type.

  - name: stg_coc_info__player_troop
    description: >
      Relationship between players and their troops with levels.
    columns:
      - name: player_troop_id
        data_type: varchar
        description: >
          Unique identifier for player-troop relationship.
        data_tests:
          - not_null
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__player')
                field: player_id
      - name: troop_id
        data_type: varchar
        description: >
          Troop identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__troops')
                field: troop_id
      - name: level
        data_type: int
        description: >
          Current troop level.
      - name: max_level
        data_type: int
        description: >
          Maximum troop level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: stg_coc_info__player_hero
    description: >
      Relationship between players and their heroes with levels.
    columns:
      - name: player_hero_id
        data_type: varchar
        description: >
          Unique identifier for player-hero relationship.
        data_tests:
          - not_null
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__player')
                field: player_id
      - name: hero_id
        data_type: varchar
        description: >
          Hero identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__heroes')
                field: hero_id
      - name: level
        data_type: int
        description: >
          Current hero level.
      - name: max_level
        data_type: int
        description: >
          Maximum hero level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: stg_coc_info__player_spell
    description: >
      Relationship between players and their spells with levels.
    columns:
      - name: player_spell_id
        data_type: varchar
        description: >
          Unique identifier for player-spell relationship.
        data_tests:
          - not_null
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__player')
                field: player_id
      - name: spell_id
        data_type: varchar
        description: >
          Spell identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__spells')
                field: spell_id
      - name: level
        data_type: int
        description: >
          Current spell level.
      - name: max_level
        data_type: int
        description: >
          Maximum spell level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: stg_coc_info__player_achievement
    description: >
      Relationship between players and their achievements with progress.
    columns:
      - name: player_achievement_id
        data_type: varchar
        description: >
          Unique identifier for player-achievement relationship.
        data_tests:
          - not_null
      - name: player_id
        data_type: varchar
        description: >
          Player identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__player')
                field: player_id
      - name: achievement_id
        data_type: varchar
        description: >
          Achievement identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__achievements')
                field: achievement_id
      - name: value
        data_type: int
        description: >
          Current achievement progress.
      - name: stars
        data_type: int
        description: >
          Stars earned for achievement.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.

  - name: stg_coc_info__player_hero_equipment
    description: >
      Relationship between player heroes and their equipment with levels.
    columns:
      - name: player_hero_equipment_id
        data_type: varchar
        description: >
          Unique identifier for player-hero-equipment relationship.
        data_tests:
          - not_null
      - name: player_hero_id
        data_type: varchar
        description: >
          Player-hero relationship identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__player_hero')
                field: player_hero_id
      - name: hero_equipment_id
        data_type: varchar
        description: >
          Hero equipment identifier.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_coc_info__hero_equipment')
                field: hero_equipment_id
      - name: level
        data_type: int
        description: >
          Current equipment level.
      - name: max_level
        data_type: int
        description: >
          Maximum equipment level.
      - name: ingest_ts
        data_type: timestamp
        description: >
          Timestamp when data was ingested.